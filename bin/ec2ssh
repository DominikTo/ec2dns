#!/usr/bin/php
<?php

/*
 * Find the Composer autoloader.
 * Credit: https://github.com/evert/sabre-vobject/blob/master/bin/vobjectvalidate.php
 */

$paths = array(
    __DIR__ . '/../vendor/autoload.php',  // In case the project is cloned directly
    __DIR__ . '/../../../autoload.php',   // In case the project is a composer dependency.
);

foreach($paths as $path) {
    if (file_exists($path)) {
        include($path);
        break;
    }
}

/*
 * 
 */
if(isset($argv[1])) {

    $username = "";
    if(strpos($argv[1], "@")) {
        $parameter = explode("@", $argv[1]);
        $username = $parameter[0];
        $tag = $parameter[1];
    } else {
        $tag = $argv[1];
    }

    if($dnsName = shell_exec(__DIR__.'/ec2host '.$tag)) {
        passthru('ssh '.((!empty($username)) ? $username : 'ubuntu').'@'.$dnsName);
    } else {
        die();
    }
    
} else {
    die();
}